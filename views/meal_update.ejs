<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles.css" />
    <title>Update Meal</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial,
          sans-serif;
        background: linear-gradient(135deg, #e6f7ff, #f0f4f8);
        margin: 0;
        padding: 0;
        color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      nav {
        position: fixed;
        top: 0;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 10px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
      }

      nav .logo {
        font-size: 24px;
        color: #007aff;
        font-weight: bold;
      }

      nav .menu a {
        margin-left: 20px;
        color: #333;
        text-decoration: none;
        font-size: 18px;
        transition: color 0.3s ease;
        position: relative;
      }

      nav .menu a:hover {
        color: #007aff;
      }

      .tooltip {
        display: none;
        position: absolute;
        background-color: rgba(173, 216, 230, 0.9);
        color: #333;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
        margin-top: 5px;
        left: 80%;
        transform: translateX(-50%);
        white-space: normal;
        width: 250px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      nav .menu a:hover + .tooltip {
        display: block;
      }

      header {
        background-color: #007aff;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 30px;
        font-weight: bold;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .container {
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        padding: 40px;
        width: 90%;
        max-width: 600px;
        animation: fadeIn 1s ease-out;
        position: relative;
        margin-top: 120px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      h1 {
        color: #007aff;
        text-align: center;
        font-size: 32px;
        margin-bottom: 20px;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      label {
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }

      input,
      select,
      textarea {
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        width: 100%;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: #007aff;
        box-shadow: 0 0 8px rgba(0, 122, 255, 0.2);
        outline: none;
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      input[type="datetime-local"] {
        color: #007aff;
        background-color: #f9f9f9;
      }

      button {
        margin-top: 20px;
        padding: 15px;
        background-color: #007aff;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      button:hover {
        background-color: #005fdb;
        box-shadow: 0 4px 10px rgba(0, 122, 255, 0.3);
      }

      button:active {
        transform: scale(0.98);
      }

      input[type="url"]::placeholder,
      input[type="text"]::placeholder,
      input[type="number"]::placeholder,
      textarea::placeholder {
        color: #aaa;
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 6px;
        background: linear-gradient(to right, #007aff, #5ac8fa);
        border-radius: 10px;
        margin-top: -25px;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="logo">SugarWize</div>
      <img src="/images/logo.png" alt="Health App Logo" style="height: 40px" />
      <div class="menu">
        <a href="/users/dashboard">Home</a>
        <a href="#" id="about-link">About</a>
        <span class="tooltip"
          >Our app is designed to empower users in managing their dietary intake
          effectively. By logging meals, users can accurately track their blood
          sugar levels. The app intelligently analyzes this data, providing
          personalized recommendations on whether users need to increase or
          decrease their sugar intake. Additionally, it sends timely
          notifications to keep users informed about their health status,
          ensuring they never miss a beat. Join us on this journey to better
          health and wellness!</span
        >
        <a href="#">Profile</a>
      </div>
    </nav>
    <header>Update Your Meal</header>
    <div class="container">
      <h1>Update Meal</h1>
      <form
        action="/meals/add"
        method="POST"
        enctype="application/x-www-form-urlencoded"
        id="mealForm"
      >
        <label for="meal_date">Date</label>
        <input type="datetime-local" id="meal_date" name="meal_date" required />

        <label for="mealType">Meal Type</label>
        <select id="mealType" name="mealType" required>
          <option value="breakfast">Breakfast</option>
          <option value="lunch">Lunch</option>
          <option value="dinner">Dinner</option>
        </select>

        <label for="image">Meal Image URL</label>
        <input
          type="url"
          id="image"
          name="image"
          placeholder="Enter image URL"
          required
        />

        <label for="description">Description</label>
        <textarea
          id="description"
          name="description"
          placeholder="Enter meal description"
          required
        ></textarea>

        <label for="bloodSugar">Blood Sugar Level</label>
        <input type="number" id="bloodSugar" name="bloodSugar" required />

        <button type="submit">Submit</button>
      </form>
    </div>

    <script>
      document
        .getElementById("mealForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault(); // למנוע שליחת טופס רגילה

          const formData = new FormData(this);

          try {
            // שליחת הנתונים לשרת
            const response = await fetch("/meals/add", {
              method: "POST",
              body: new URLSearchParams(formData),
            });

            const contentType = response.headers.get("content-type");
            let result;

            if (contentType && contentType.includes("application/json")) {
              result = await response.json(); // הנחה שהשרת מחזיר תשובה כ-JSON

              if (result.success) {
                // הצגת החלונית הקופצת עם הערך שחוזה
                alert(
                  `The predicted blood sugar level is: ${result.predictedBloodSugar}`
                );

                // מעבר למסך ההיסטוריה
                window.location.href = "/meals/history"; // עדכן ל-URL של מסך ההיסטוריה
              } else {
                alert("Failed to update meal. Please try again.");
              }
            } else {
              const text = await response.text(); // לקבל את התגובה כטקסט אם לא JSON
              alert(`Error: ${text}`);
            }
          } catch (err) {
            console.error("Error submitting meal:", err);
            alert("An error occurred while submitting the meal.");
          }
        });
    </script>
  </body>
</html>
